// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// NextAuth.js required models
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  password      String?
  role          String    @default("student") // student, admin
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  accounts      Account[]
  sessions      Session[]
  enrollments   Enrollment[]
  payments      Payment[]
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@id([identifier, token])
}

// Course management models
model Course {
  id                    String   @id @default(cuid())
  title                 String
  description           String
  image                 String?
  videoUrl              String?  // Course intro/promo video (YouTube URL)
  price                 Float    @default(0)
  isPaid                Boolean  @default(false)
  isPublished           Boolean  @default(false)
  category              String?
  level                 String?  // beginner, intermediate, advanced
  duration              String?  // e.g., "10 hours"
  accessDurationMonths  Int      @default(6) // Course access duration in months
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  lessons     Lesson[]
  enrollments Enrollment[]
  payments    Payment[]
  
  @@index([isPublished])
  @@index([category])
  @@index([createdAt])
}

model Lesson {
  id          String   @id @default(cuid())
  courseId    String
  title       String
  description String?
  content     String   // Rich text content
  videoUrl    String?
  duration    String?
  order       Int
  isFree      Boolean  @default(false) // Some lessons can be free previews
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  progress    LessonProgress[]
  
  @@index([courseId])
  @@index([order])
}

model Enrollment {
  id          String   @id @default(cuid())
  userId      String
  courseId    String
  enrolledAt  DateTime @default(now())
  expiresAt   DateTime? // For time-limited access
  progress    Int      @default(0) // 0-100
  completed   Boolean  @default(false)
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  @@index([userId])
  @@index([courseId])
  @@index([enrolledAt])
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  
  @@unique([userId, courseId])
}

model LessonProgress {
  id          String   @id @default(cuid())
  userId      String
  lessonId    String
  completed   Boolean  @default(false)
  watchTime   Int      @default(0) // in seconds
  completedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  lesson      Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  
  @@unique([userId, lessonId])
}

model Payment {
  id              String   @id @default(cuid())
  userId          String
  courseId        String
  amount          Float
  currency        String   @default("usd")
  status          String   // pending, completed, failed, refunded
  stripePaymentId String?  @unique
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course          Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

model Mentor {
  id              String   @id @default(cuid())
  name            String
  role            String   // e.g., "Learning Path Designer", "Senior Educator"
  company         String?  // e.g., "Independent Educator"
  bio             String   // Short bio/introduction
  image           String?  // Profile image URL
  expertise       String   // Areas of expertise
  experience      String?  // Years of experience or description
  achievements    String?  // Key achievements (JSON array or comma-separated)
  socialLinks     String?  // Social media links (JSON object)
  isActive        Boolean  @default(true)
  displayOrder    Int      @default(0) // For sorting mentors
  totalStudents   Int      @default(0)
  totalCourses    Int      @default(0)
  
  @@index([isActive, displayOrder])
  rating          Float    @default(5.0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
